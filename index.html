<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TavernKeeper</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    />
    <link rel="stylesheet" href="main.css" />
  </head>
  <body>
    <div class="floating-menu" id="floating-menu">
      <div class="toolbar-title">TavernKeeper</div>
      <div class="dropdown">
        <select class="dropdown-select" onchange="handleDropdownChange(this.value)">
          <option value="http://127.0.0.1:8000">Sillytavern</option>
          <option value="http://127.0.0.1:7860">Text Gen</option>
          <option value="http://127.0.0.1:7861">Stable Diffusion</option>
          <option value="http://127.0.0.1:8188">ComfyUI</option>
        </select>
      </div>
      <div class="checkbox-container">
        <input type="checkbox" id="new-window-checkbox" />
        <label for="new-window-checkbox">New window</label>
      </div>
      <div class="right-align">
        <button class="gear-icon" onclick="handleClick('config.html')" tabindex="0" aria-label="Settings"></button>
      </div>
    </div>
    <div class="iframe-container">
      <iframe id="content-frame" style="background-color: #2e2e2e; color: #839496;"></iframe>
    </div>

    <script>
      function handleClick(url) {
        const openInNewWindow = document.getElementById('new-window-checkbox').checked;
        if (openInNewWindow || window.innerWidth <= 768) {
          // Open in new window if checkbox is checked or on mobile view
          window.open(url, '_blank');
        } else {
          // Desktop view: load in iframe
          document.getElementById('content-frame').src = url;
        }
      }

      function handleDropdownChange(url) {
        if (url) {
          handleClick(url);
        }
      }

      // Load Sillytavern in iframe by default
      document.addEventListener("DOMContentLoaded", function () {
        handleClick('http://127.0.0.1:8000');
      });
    </script>

  </body>
</html>
